<% include ../partials/header %>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.15/css/theme.bootstrap_3.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.15/js/jquery.tablesorter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.15/js/jquery.tablesorter.widgets.min.js"></script>
    <header>
        <h1>
            <span>Schools</span>
            <a class="btn btn-primary btn-sm pull-right role_wa" href="/schools/new">Add New School</a>
         </h1>
    </header>
    <%
    var unasgn, unsched,
        qTot=0,
        unasgnTot=0,
        unschedTot=0,
        servedTot=0;
    %>
    <table id="schoolTable" class="table table-striped tablesorter">
        <thead>
            <tr>
                <th>Name</th>
                <th>District</th>
                <th>Quota</th>
                <th>Quota Unassigned</th>
                <th>Quota Unscheduled</th>
                <th>Students Served</th>
            </tr>
        </thead>
        <tbody>
            <% schools.forEach(function(school){ %>
                <tr>
                    <%
                    unasgn= school.quota - school.count;
                    unsched= school.quota - school.schedCount;
                    qTot+=school.quota;
                    unasgnTot+=unasgn;
                    unschedTot+=unsched;
                    servedTot+=school.servedCount;
                    %>
                    <td><%= school.name %></td>
                    <td><%= school.district %></td>
                    <td><%= school.quota %></td>
                    <td><%= unasgn %></td>
                    <td><%= unsched %></td>
                    <td><%= school.servedCount %></td>
                    <td>
                        <form style="display: inline" action="/schools/<%=school._id%>?_method=DELETE" method="POST">
                            <a href="/schools/<%=school._id%>/edit" class="btn btn-xs btn-info">Edit</a>
                            <button class="hidden" class="btn btn-xs btn-danger">DELETE</button>
                        </form>
                    </td>
                </tr>
            <% }); %>
        </tbody>
        <tfoot>
             <tr>
                <td>Totals</td>
                <td></td>
                <td>Quota</td>
                <td>Quota Unassigned</td>
                <td>Quota Unscheduled</td>
                <td>Students Served</td>
                <td>
                </td>
            </tr>
             <tr>
                <td></td>
                <td></td>
                <td><%= qTot %></td>
                <td><%= unasgnTot %></td>
                <td><%= unschedTot %></td>
                <td><%= servedTot %></td>
                <td>
                </td>
            </tr>
        </tfoot>
    </table>

<script>
$(function(){
  $("#schoolTable").tablesorter(
      { theme: 'bootstrap',
        headerTemplate : '{content} {icon}',
        widgets : [ "uitheme" ]
      });
});
</script>

<% include ../partials/footer %>
